<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BonziGAME — Maze for Bananas</title>
  <style>
    @font-face {
      font-family: 'akkaregular';
      src: url('akka-webfont.woff2') format('woff2'),
           url('akka-webfont.woff') format('woff');
      font-weight: normal;
      font-style: normal;
      font-display: swap;
    }
    
    @font-face {
      font-family: 'consolasregular';
      src: url('consola-webfont.woff2') format('woff2'),
           url('consola-webfont.woff') format('woff');
      font-weight: normal;
      font-style: normal;
      font-display: swap;
    }
    
    html,body{height:100%;margin:0;font-family:Tahoma,Arial,sans-serif;background:#1a1a1a;color:#fff;display:flex;flex-direction:column;align-items:center;}
    #ui{padding:10px;width:100%;max-width:900px;display:flex;justify-content:space-around;align-items:center;background:#333;border-bottom:3px solid #555;}
    #container{display:flex;justify-content:center;align-items:center;flex-grow:1;width:100%;background:#222;}
    canvas{border:4px solid #444;border-radius:12px;background:#3d6b3d;image-rendering:pixelated;}
    #shop{display:none;flex-direction:column;align-items:center;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.85);z-index:10;overflow-y:auto;padding:20px 0;}
    #shop h2{font-family:'akkaregular',Tahoma,Arial,sans-serif;font-size:48px;margin-bottom:20px;font-weight:normal;letter-spacing:2px;text-transform:uppercase;}
    #shopItems{margin:20px;display:flex;flex-direction:column;gap:8px;max-width:600px;width:90%;font-family:Tahoma,Arial,sans-serif;}
    button{background:#4c8bff;border:none;color:#fff;padding:8px 14px;border-radius:6px;cursor:pointer;font-weight:bold;font-family:Tahoma,Arial,sans-serif;}
    button:hover{background:#70aaff;}
    #loader{position:fixed;left:0;top:0;right:0;bottom:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.6);z-index:20;color:#fff;font-size:18px}
    img.hidden { display: none; }
    #closeShop{margin:20px 0 40px 0;padding:12px 30px;}
    #changelogBtn{background:#6b4c8b;margin-left:10px;}
    #changelogBtn:hover{background:#8b6cbb;}
    #changelog{display:none;flex-direction:column;align-items:center;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.9);z-index:15;overflow-y:auto;padding:40px 20px;font-family:Tahoma,Arial,sans-serif;}
    #changelogContent{max-width:700px;width:90%;background:#2a2a2a;padding:30px;border-radius:12px;border:3px solid #555;}
    #changelogContent h2{color:#4c8bff;margin-top:0;font-size:28px;}
    #changelogContent h3{color:#70aaff;margin-top:20px;margin-bottom:10px;font-size:20px;}
    #changelogContent ul{line-height:1.8;color:#ddd;}
    #changelogContent li{margin-bottom:8px;}
    .version{color:#ffd700;font-weight:bold;}
  </style>
</head>
<body>
  <div id="ui">
    <span>BonziGAME</span>
    <span>Level: <span id="level">1</span>/100</span>
    <span>Bananas: <span id="remaining">0</span></span>
    <span>Coins: <span id="coins">0</span></span>
    <button id="openShop">Shop</button>
    <button id="changelogBtn">Changelog</button>
  </div>
  <div id="container">
    <canvas id="game" width="640" height="480"></canvas>
  </div>

  <div id="shop">
    <h2>Bonzi Shop</h2>
    <div id="shopItems"></div>
    <button id="closeShop">Close</button>
  </div>

  <div id="changelog">
    <div id="changelogContent">
      <h2>BonziGAME Changelog</h2>
      <ul>
      <h3><span class="version">v1.0</span> - Initial Release</h3>
      <ul>
        <li>100 progressively harder maze levels</li>
        <li>Play as Bonzi the gorilla</li>
        <li>Collect bananas to advance through levels</li>
        <li>Arrow keys and WASD controls</li>
        <li>Procedurally generated mazes</li>
        <li>Victory celebration at level 100</li>
      </ul>

      <button id="closeChangelog">Close</button>
    </div>
  </div>

  <div id="loader">Loading images…</div>

  <!-- Direct image links for gorilla and banana -->
  <img id="gorillaImg" class="hidden" src="https://super-salmon-aadzcmaf7s.edgeone.app/61851.png" alt="Gorilla">
  <img id="bananaImg" class="hidden" src="https://super-salmon-aadzcmaf7s.edgeone.app/67068.png" alt="Banana">

<script src="https://cdn.jsdelivr.net/npm/party-js@latest/bundle/party.min.js"></script>
<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const levelLabel = document.getElementById('level');
const coinsLabel = document.getElementById('coins');
const remainingLabel = document.getElementById('remaining');
const openShopBtn = document.getElementById('openShop');
const closeShopBtn = document.getElementById('closeShop');
const shopDiv = document.getElementById('shop');
const shopItemsDiv = document.getElementById('shopItems');
const loader = document.getElementById('loader');
const changelogBtn = document.getElementById('changelogBtn');
const changelogDiv = document.getElementById('changelog');
const closeChangelogBtn = document.getElementById('closeChangelog');

const gorillaImg = document.getElementById('gorillaImg');
const bananaImg = document.getElementById('bananaImg');

let TILE=32, rows=15, cols=20;
let maze=[];
let bananas=new Set();
let player={r:1,c:1,speed:1.0};
let coins=0, curLevel=1;
let keys={};
let purchases={speedBoost:0, doubler:false, magnet:false, xray:false};
let gameCompleted=false;

const sndCollect = new Audio('https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg');
const sndLevel = new Audio('https://actions.google.com/sounds/v1/cartoon/slide_whistle_to_drum_hit.ogg');
const sndBuy = new Audio('https://actions.google.com/sounds/v1/cartoon/pop.ogg');
const sndVictory = new Audio('https://bwnzykwnzy.edgeone.app/in8bx-uk75w.mp3');

function setLevelSize(level){
  rows=Math.min(10+Math.floor(level*0.1),40);
  cols=Math.min(14+Math.floor(level*0.12),60);
  TILE=Math.max(16,Math.floor(640/cols));
  canvas.width=cols*TILE; canvas.height=rows*TILE;
}

function inBounds(r,c){ return r>0 && c>0 && r<rows-1 && c<cols-1; }

function generateMaze(){
  maze = Array.from({length:rows}, ()=>Array(cols).fill(1));
  const stack = [[1,1]];
  maze[1][1] = 0;
  while(stack.length){
    const [r,c] = stack[stack.length-1];
    const dirs = [[0,2],[0,-2],[2,0],[-2,0]].sort(()=>Math.random()-0.5);
    let carved = false;
    for(const [dr,dc] of dirs){
      const nr = r+dr, nc = c+dc;
      if(inBounds(nr,nc) && maze[nr][nc] === 1){
        maze[nr][nc] = 0;
        maze[r + dr/2][c + dc/2] = 0;
        stack.push([nr,nc]); carved = true; break;
      }
    }
    if(!carved) stack.pop();
  }
}

function placeBananas(){
  bananas.clear();
  const spots = [];
  for(let r=1;r<rows-1;r++) for(let c=1;c<cols-1;c++) if(maze[r][c]===0) spots.push([r,c]);
  const count = Math.min(4 + Math.floor(curLevel*0.3), 20);
  while(bananas.size < count){
    const s = spots[Math.floor(Math.random()*spots.length)];
    const key = `${s[0]},${s[1]}`;
    if((s[0]!==1||s[1]!==1) && !bananas.has(key)) bananas.add(key);
  }
  remainingLabel.textContent = bananas.size;
}

function startLevel(){
  setLevelSize(curLevel);
  generateMaze();
  placeBananas();
  player.r = 1; player.c = 1;
  updateUI();
  draw();
}

function updateUI(){ levelLabel.textContent = curLevel; remainingLabel.textContent = bananas.size; coinsLabel.textContent = coins; }

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle = '#2a2a2a'; ctx.fillRect(0,0,canvas.width,canvas.height);
  for(let r=0;r<rows;r++){
    for(let c=0;c<cols;c++){
      ctx.fillStyle = maze[r][c] ? '#1f1f1f' : '#4a9b4a';
      ctx.fillRect(c*TILE, r*TILE, TILE, TILE);
    }
  }
  bananas.forEach(k=>{
    const [r,c] = k.split(',').map(Number);
    if(player.xray){
      ctx.fillStyle = 'rgba(255,255,0,0.3)';
      ctx.fillRect(c*TILE, r*TILE, TILE, TILE);
    }
    ctx.drawImage(bananaImg, c*TILE+TILE*0.2, r*TILE+TILE*0.2, TILE*0.6, TILE*0.6);
  });
  const gorillaSize = TILE * 0.75;
  const gorillaX = player.c * TILE + (TILE - gorillaSize) / 2;
  const gorillaY = player.r * TILE + (TILE - gorillaSize) / 2;
  ctx.drawImage(gorillaImg, gorillaX, gorillaY, gorillaSize, gorillaSize);
}

function tryMove(dr,dc){
  const nr = player.r + dr, nc = player.c + dc;
  if(nr<0||nc<0||nr>=rows||nc>=cols) return;
  const canWalk = maze[nr][nc]===0 || (player.wallHack && player.wallHack>0);
  if(canWalk){
    if(maze[nr][nc]===1 && player.wallHack>0) player.wallHack--;
    player.r = nr; player.c = nc;
    const key = `${nr},${nc}`;
    if(bananas.has(key)){
      bananas.delete(key); 
      coins += player.doubler ? 20 : 10; 
      try{ sndCollect.currentTime = 0; sndCollect.play(); }catch(e){}
      updateUI();
      if(bananas.size === 0){ 
        try{ sndLevel.currentTime = 0; sndLevel.play(); }catch(e){}
        if(curLevel >= 100){
          gameCompleted = true;
          try{ sndVictory.currentTime = 0; sndVictory.play(); }catch(e){}
          document.querySelector('#ui span:first-child').textContent = 'b͛w͛n͛z͛y͛k͛w͛n͛z͛y͛';
          setTimeout(()=>{
            alert('CONGRATULATIONS! YOU COMPLETED ALL 100 LEVELS!\n\nb͛w͛n͛z͛y͛k͛w͛n͛z͛y͛');
          }, 500);
        } else {
          curLevel++; 
          setTimeout(startLevel, 300);
        }
      }
    }
    // Banana Magnet: collect nearby bananas
    if(player.magnet){
      [[0,1],[0,-1],[1,0],[-1,0]].forEach(([dr2,dc2])=>{
        const mr=nr+dr2, mc=nc+dc2;
        const mkey=`${mr},${mc}`;
        if(bananas.has(mkey)){
          bananas.delete(mkey);
          coins += player.doubler ? 20 : 10;
          try{ sndCollect.currentTime=0; sndCollect.play(); }catch(e){}
          updateUI();
        }
      });
      if(bananas.size === 0){ 
        try{ sndLevel.currentTime = 0; sndLevel.play(); }catch(e){}
        if(curLevel >= 100){
          gameCompleted = true;
          try{ sndVictory.currentTime = 0; sndVictory.play(); }catch(e){}
          document.querySelector('#ui span:first-child').textContent = 'b͛w͛n͛z͛y͛k͛w͛n͛z͛y͛';
          setTimeout(()=>{
            alert('CONGRATULATIONS! YOU COMPLETED ALL 100 LEVELS!\n\nb͛w͛n͛z͛y͛k͛w͛n͛z͛y͛');
          }, 500);
        } else {
          curLevel++; 
          setTimeout(startLevel, 300);
        }
      }
    }
  }
}

window.addEventListener('keydown', e=>{
  if(['ArrowUp','ArrowDown','ArrowLeft','ArrowRight','w','a','s','d','W','A','S','D'].includes(e.key)) e.preventDefault();
  keys[e.key.toLowerCase()] = true;
});
window.addEventListener('keyup', e=>{ keys[e.key.toLowerCase()] = false; });

function gameLoop(){
  if(gameCompleted) return;
  if(keys['arrowup']||keys['w']){ tryMove(-1,0); keys['arrowup']=keys['w']=false; }
  else if(keys['arrowdown']||keys['s']){ tryMove(1,0); keys['arrowdown']=keys['s']=false; }
  else if(keys['arrowleft']||keys['a']){ tryMove(0,-1); keys['arrowleft']=keys['a']=false; }
  else if(keys['arrowright']||keys['d']){ tryMove(0,1); keys['arrowright']=keys['d']=false; }
  draw();
  requestAnimationFrame(gameLoop);
}

const shopItems = [
  {
    name:'Speed Boost', 
    cost:100, 
    desc:'Move faster through the maze', 
    limit:5, 
    check:()=>purchases.speedBoost<5, 
    buy:()=>{player.speed+=0.1; purchases.speedBoost++;},
    getStatus:()=>purchases.speedBoost<5 ? `${purchases.speedBoost}/5` : 'MAXED'
  },
  {
    name:'Banana Doubler', 
    cost:150, 
    desc:'Earn 20 coins per banana instead of 10', 
    limit:1, 
    check:()=>!purchases.doubler, 
    buy:()=>{player.doubler=true; purchases.doubler=true;},
    getStatus:()=>purchases.doubler ? 'OWNED' : 'Available'
  },
  {
    name:'Level Skip', 
    cost:200, 
    desc:'Instantly advance to the next level', 
    buy:()=>{curLevel++; startLevel(); shopDiv.style.display='none';},
    getStatus:()=>'Unlimited'
  },
  {
    name:'Mega Bonus', 
    cost:300, 
    desc:'Receive 500 coins immediately', 
    buy:()=>{coins+=500; updateUI();},
    getStatus:()=>'Unlimited'
  },
  {
    name:'Wall Hack', 
    cost:500, 
    desc:'Phase through 5 walls', 
    buy:()=>{player.wallHack=(player.wallHack||0)+5;},
    getStatus:()=>player.wallHack ? `${player.wallHack} uses left` : 'Buy to activate'
  },
  {
    name:'Banana Magnet', 
    cost:250, 
    desc:'Auto-collect bananas in adjacent tiles', 
    limit:1, 
    check:()=>!purchases.magnet, 
    buy:()=>{player.magnet=true; purchases.magnet=true;},
    getStatus:()=>purchases.magnet ? 'OWNED' : 'Available'
  },
  {
    name:'X-Ray Vision', 
    cost:400, 
    desc:'Highlights all banana locations', 
    limit:1, 
    check:()=>!purchases.xray, 
    buy:()=>{player.xray=true; purchases.xray=true;},
    getStatus:()=>purchases.xray ? 'OWNED' : 'Available'
  }
];

function renderShop(){
  shopItemsDiv.innerHTML = '';
  shopItems.forEach(it=>{
    const isOwned = it.check && !it.check();
    const canAfford = coins >= it.cost;
    
    const itemDiv = document.createElement('div');
    itemDiv.style.cssText = 'margin-bottom:10px;background:#2a2a2a;padding:12px;border-radius:8px;border:2px solid #444;display:flex;justify-content:space-between;align-items:center;';
    if(isOwned) itemDiv.style.borderColor = '#666';
    
    const infoDiv = document.createElement('div');
    infoDiv.style.flex = '1';
    infoDiv.innerHTML = `
      <div style="display:flex;align-items:center;gap:8px;margin-bottom:4px;">
        <span style="font-family:'consolasregular',monospace;font-weight:bold;font-size:16px;">${it.name}</span>
        <span style="color:#ffd700;font-size:14px;">${it.cost} coins</span>
      </div>
      <div style="color:#aaa;font-size:13px;margin-bottom:4px;">${it.desc}</div>
      <div style="color:${isOwned?'#4a9b4a':'#70aaff'};font-size:12px;font-weight:bold;">Status: ${it.getStatus()}</div>
    `;
    
    const buyBtn = document.createElement('button');
    buyBtn.textContent = isOwned ? 'Owned' : 'Buy';
    buyBtn.style.cssText = 'padding:10px 20px;font-size:14px;min-width:80px;';
    
    if(isOwned){
      buyBtn.disabled = true;
      buyBtn.style.opacity = '0.5';
      buyBtn.style.cursor = 'not-allowed';
      buyBtn.style.background = '#555';
    } else if(!canAfford){
      buyBtn.style.opacity = '0.6';
      buyBtn.style.cursor = 'not-allowed';
    }
    
    buyBtn.onclick = ()=>{
      if(isOwned){ 
        alert('You already own this item!'); 
        return; 
      }
      if(!canAfford){ 
        alert(`You need ${it.cost - coins} more coins!`); 
        return; 
      }
      coins -= it.cost;
      it.buy();
      try{ sndBuy.currentTime=0; sndBuy.play(); }catch(e){}
      updateUI();
      renderShop();
    };
    
    itemDiv.appendChild(infoDiv);
    itemDiv.appendChild(buyBtn);
    shopItemsDiv.appendChild(itemDiv);
  });
}

openShopBtn.onclick = ()=>{
  renderShop();
  shopDiv.style.display = 'flex';
};
closeShopBtn.onclick = ()=> shopDiv.style.display='none';

changelogBtn.onclick = ()=> changelogDiv.style.display = 'flex';
closeChangelogBtn.onclick = ()=> changelogDiv.style.display = 'none';

// Wait for both images to finish loading before starting game
let loadedImages = 0;
[gorillaImg, bananaImg].forEach(img => {
  if (img.complete) {
    loadedImages++;
  } else {
    img.onload = () => {
      loadedImages++;
      if (loadedImages === 2) initGame();
    };
    img.onerror = () => {
      console.warn(`Image failed to load: ${img.src}`);
      loadedImages++;
      if (loadedImages === 2) initGame();
    };
  }
});

if (loadedImages === 2) initGame();

function initGame() {
  loader.style.display = 'none';
  startLevel();
  requestAnimationFrame(gameLoop);
}
</script>
</body>
</html>
